<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•</title>
    <link rel="stylesheet" href="/assets/css/APlayer.min.css">
    <link rel="stylesheet" href="/assets/css/APlayer.custom.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .log {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-item {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #4CAF50;
            background: white;
        }
        .log-item.error {
            border-left-color: #f44336;
        }
        .log-item.warning {
            border-left-color: #ff9800;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸµ éŸ³ä¹æ’­æ”¾å™¨è¯Šæ–­æµ‹è¯•</h1>
        <div id="log" class="log">
            <div class="log-item">æ­£åœ¨åˆå§‹åŒ–...</div>
        </div>
        
        <h2>æ’­æ”¾å™¨å®¹å™¨</h2>
        <div id="aplayer-container">
            <meting-js
                server="netease"
                type="playlist"
                id="7452421335"
                api="https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r"
                fixed="true"
                mini="true"
                autoplay="false"
                theme="#b7daff"
                loop="all"
                order="list"
                preload="auto"
                volume="0.7"
                mutex="true"
                lrc-type="3"
                list-folded="false"
                list-max-height="340px"
                storage-name="aplayer-setting"
            ></meting-js>
        </div>
    </div>

    <script>
        const logContainer = document.getElementById('log');
        
        function log(message, type = 'info') {
            const item = document.createElement('div');
            item.className = `log-item ${type}`;
            item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(item);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        // æµ‹è¯• 1: æ£€æŸ¥ APlayer CSS
        log('âœ“ APlayer CSS å·²åŠ è½½');

        // æµ‹è¯• 2: åŠ è½½ APlayer JS
        log('æ­£åœ¨åŠ è½½ APlayer.js...');
        const aplayerScript = document.createElement('script');
        aplayerScript.src = '/assets/js/APlayer.min.js';
        aplayerScript.onload = () => {
            log('âœ“ APlayer.js åŠ è½½æˆåŠŸ');
            log(`âœ“ window.APlayer å­˜åœ¨: ${!!window.APlayer}`);
            
            // æµ‹è¯• 3: åŠ è½½ MetingJS
            log('æ­£åœ¨åŠ è½½ Meting.js...');
            const metingScript = document.createElement('script');
            metingScript.src = 'https://unpkg.com/meting@2/dist/Meting.min.js';
            metingScript.onload = () => {
                log('âœ“ Meting.js åŠ è½½æˆåŠŸ');
                log(`âœ“ customElements.get('meting-js'): ${!!customElements.get('meting-js')}`);
                
                // æµ‹è¯• 4: æ£€æŸ¥ meting-js å…ƒç´ 
                setTimeout(() => {
                    const metingElement = document.querySelector('meting-js');
                    log(`âœ“ meting-js å…ƒç´ å­˜åœ¨: ${!!metingElement}`);
                    
                    if (metingElement) {
                        log(`âœ“ meting-js.aplayer å­˜åœ¨: ${!!metingElement.aplayer}`);
                        
                        // æµ‹è¯• 5: æ£€æŸ¥ APlayer å®ä¾‹
                        const checkInterval = setInterval(() => {
                            if (metingElement.aplayer) {
                                clearInterval(checkInterval);
                                const aplayer = metingElement.aplayer;
                                log(`âœ“ APlayer å®ä¾‹å·²åˆ›å»º`);
                                log(`âœ“ éŸ³é¢‘åˆ—è¡¨é•¿åº¦: ${aplayer.list?.audios?.length || 0}`);
                                
                                if (aplayer.list?.audios?.length > 0) {
                                    log('âœ… éŸ³ä¹æ’­æ”¾å™¨åˆå§‹åŒ–æˆåŠŸï¼', 'info');
                                    log(`ç¬¬ä¸€é¦–æ­Œ: ${aplayer.list.audios[0].name} - ${aplayer.list.audios[0].artist}`);
                                } else {
                                    log('âŒ éŸ³é¢‘åˆ—è¡¨ä¸ºç©ºï¼ŒAPI å¯èƒ½å¤±è´¥', 'error');
                                }
                            }
                        }, 100);
                        
                        // 10ç§’ååœæ­¢æ£€æŸ¥
                        setTimeout(() => {
                            clearInterval(checkInterval);
                            if (!metingElement.aplayer) {
                                log('âŒ 10ç§’åä»æœªåˆ›å»º APlayer å®ä¾‹', 'error');
                            }
                        }, 10000);
                    }
                }, 1000);
            };
            metingScript.onerror = () => {
                log('âŒ Meting.js åŠ è½½å¤±è´¥', 'error');
            };
            document.head.appendChild(metingScript);
        };
        aplayerScript.onerror = () => {
            log('âŒ APlayer.js åŠ è½½å¤±è´¥', 'error');
        };
        document.head.appendChild(aplayerScript);

        // æµ‹è¯• 6: æµ‹è¯• API å¯è®¿é—®æ€§
        log('æ­£åœ¨æµ‹è¯• API å¯è®¿é—®æ€§...');
        fetch('https://api.i-meto.com/meting/api?server=netease&type=playlist&id=7452421335&r=' + Math.random())
            .then(response => {
                log(`âœ“ API å“åº”çŠ¶æ€: ${response.status}`);
                return response.json();
            })
            .then(data => {
                log(`âœ“ API è¿”å›æ•°æ®: ${data.length} é¦–æ­Œæ›²`);
            })
            .catch(error => {
                log(`âŒ API è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            });
    </script>
</body>
</html>

